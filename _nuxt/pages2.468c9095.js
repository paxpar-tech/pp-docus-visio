import{d as K,r as v,O as E,o as O,bU as W,b as p,c as d,e as i,W as I,g as x,F as h,a0 as b,t as f,n as D,w as P,j as U,M as J}from"./entry.558da846.js";import{_ as Q}from"./debug-panel.vue.d1231d3b.js";import{u as Z}from"./useToast.582151af.js";import{g as tt}from"./index.4db78ffb.js";import"./useFeatureFlag.62790515.js";const et={class:"stack w-full"},ot=i("h1",null,"XXXXX",-1),st=["innerHTML"],nt={class:"flex my-4 w-full"},at=["onClick"],lt=i("h1",null,"loaded SVG",-1),rt={class:"pl-4"},it={class:"pl-4"},ct={class:"pl-4"},ut=["set"],pt=20,dt=1,ft=1,gt=.1,ht=!1,wt=K({__name:"pages2",props:{href:{},transposeDef:{},transposeSpot:{}},setup(L){const a=L,{$fetch2:X}=U(),g=tt.timeline({repeat:-1,repeatDelay:2}),A=v(),k=v(),R=v(),_=v({node:void 0,pages:[]}),m=v(!0),y=v(1),z=Z();E(a,async(t,e)=>{await S()}),E(m,async(t,e)=>{console.log("autoplay",{newValue:t,oldValue:e}),t?g.play():g.pause()}),E(y,async(t,e)=>{g.timeScale(t)}),O(async()=>{await S()});const S=async()=>{if(a.href)try{var t=await X(a.href,{parseResponse:e=>e});A.value=t,setTimeout(C)}catch{z.error(`Erreur lors de la récupération de l'animation ${a.href}`)}};function Y(t){console.log(`goto page ${t} ...`),m.value?g.seek(`page${t}`):g.seek(`page${t+1}`)}const j=t=>{var s,l;const e=(s=a==null?void 0:a.transposeSpot)==null?void 0:s.color,r=(l=a==null?void 0:a.transposeDef)==null?void 0:l.color;e===void 0||r===void 0||r.forEach((n,o)=>{const c=n[e];Object.keys(n).forEach((u,B)=>{if(u!==e){const M=n[u];M!==c&&(console.log(`transpose color ${e} from ${M} to ${c}`),t.querySelectorAll('svg [style*="fill:#1197a5"]').forEach((T,mt)=>{const H=T.attributes.style;console.log("color transpose on ",T,H),T.style.fill=c}))}})})},q=t=>{var e;(e=a==null?void 0:a.transposeSpot)!=null&&e.logo&&console.log(`apply transpose logo ${a.transposeSpot.logo}`)},N=t=>{var e;(e=a==null?void 0:a.transposeSpot)!=null&&e.text&&console.log(`apply transpose text ${a.transposeSpot.text}`)},C=()=>{const t=k.value.querySelector("svg");t.setAttribute("width","auto"),t.setAttribute("height","auto"),console.log("svg",t);const e={node:t,pages:[]};ht&&(j(t),q(),N());const r=t.children[0].children;Array.prototype.forEach.call(r,(l,n)=>{const o=t.createSVGRect();o.x=l.getAttribute("x"),o.y=l.getAttribute("y"),o.width=l.getAttribute("width"),o.height=l.getAttribute("height");const c={rect:o,viewBox:w(o),stages:[]};e.pages.push(c)});for(var s=1;s<=pt;s++)t.querySelectorAll(`svg [ref='stage${s}']`).forEach((n,o)=>{e.pages.forEach((c,$)=>{const u=F(G(n),c.rect);if(n.getBBox(),c.rect,u){for(;c.stages.length<s;)c.stages.push({nodes:[]});c.stages[s-1].nodes.push(n)}})});_.value=e,R.value=t,e.pages.forEach((l,n)=>{g.to(_.value.node,{attr:{viewBox:l.viewBox},duration:dt},`page${n+1}`),l.stages.forEach((o,c)=>{g.from(o.nodes,{opacity:0,duration:ft,stagger:gt})})}),g.restart()};function F(t,e){const r=t.x+t.width/2,s=t.y+t.height/2;return e.x<=r&&r<=e.x+e.width&&e.y<=s&&s<=e.y+e.height}function w(t){return`${Math.round(t.x)} ${Math.round(t.y)} ${Math.round(t.width)} ${Math.round(t.height)}`}function G(t){const e=t.getBBox();var r=t.ownerSVGElement,s=r.createSVGPoint();s.x=e.x,s.y=e.y;const l=s.matrixTransform(V(t,r));s.x=e.x+e.width,s.y=e.y+e.height;const n=s.matrixTransform(V(t,r));var o=r.createSVGRect();return o.x=l.x,o.y=l.y,o.width=n.x-l.x,o.height=n.y-l.y,o}function V(t,e){return e.getCTM().inverse().multiply(t.getCTM())}return(t,e)=>{const r=J,s=Q,l=W("motion-fade");return p(),d(h,null,[i("div",et,[ot,I(i("div",{ref_key:"container",ref:k,class:"object-contain w-full",innerHTML:A.value},null,8,st),[[l]])]),i("div",nt,[i("button",{onClick:e[0]||(e[0]=n=>m.value=!m.value),class:"btn px-6 mx-4"},[x(r,{name:m.value?"mdi:pause":"mdi:play",size:"32"},null,8,["name"])]),(p(!0),d(h,null,b(_.value.pages,(n,o)=>(p(),d("button",{onClick:c=>Y(o+1),class:"btn px-2 m-1"},f(o+1),9,at))),256)),i("button",{onClick:S,class:"btn px-2 mx-4"},[x(r,{name:"oi:reload",size:"32"})]),i("button",{onClick:e[1]||(e[1]=n=>y.value=.5),class:D(["btn px-2 mx-1",y.value==.5?"":"btn-outline"])},[x(r,{name:"fluent:animal-turtle-16-filled",size:"32"})],2),i("button",{onClick:e[2]||(e[2]=n=>y.value=1),class:D(["btn px-2 mx-1",y.value==1?"":"btn-outline"])},[x(r,{name:"fluent:animal-rabbit-24-filled",size:"32"})],2)]),x(s,null,{default:P(()=>[i("p",null,"transposeDef = "+f(t.transposeDef),1),i("p",null,"transposeSpot = "+f(t.transposeSpot),1),i("button",{class:"btn",onClick:C},"loadSVG2"),lt,i("ul",rt,[(p(!0),d(h,null,b(_.value.pages,(n,o)=>(p(),d(h,null,[i("li",null,"page "+f(o+1)+", viewBox "+f(w(n.rect)),1),i("ul",it,[(p(!0),d(h,null,b(n.stages,(c,$)=>(p(),d(h,null,[i("li",null,"stage "+f($+1),1),i("ul",ct,[(p(!0),d(h,null,b(c.nodes,(u,B)=>(p(),d("li",{set:t.bbox=G(u)}," node "+f(B+1)+", id:"+f(u==null?void 0:u.id)+", bbox: "+f(w(t.bbox))+", ",9,ut))),256))])],64))),256))])],64))),256))])]),_:1})],64)}}});export{wt as default};
